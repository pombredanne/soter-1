#! /usr/bin/env php
<?php
/**
 * Create and run the Soter security checker console application.
 *
 * @package soter
 */

use SSNepenthe\Soter\Console\Command\CheckProjectCommand;
use SSNepenthe\Soter\Console\Command\CheckPluginCommand;
use SSNepenthe\Soter\Console\Command\CheckThemeCommand;
use SSNepenthe\Soter\Console\Command\CheckWordPressCommand;
use SSNepenthe\Soter\Console\Command\CacheClearCommand;
use Symfony\Component\Console\Application;

function ssn_require_once_if_exists( $file ) {
	if ( file_exists( $file ) ) {
		return require_once $file;
	}

	return false;
}

$soter_autoload = sprintf( '%s/vendor/autoload.php', dirname( __DIR__ ) );
$project_autoload = sprintf(
	'%s/vendor/autoload.php',
	dirname( dirname( dirname( __DIR__ ) ) )
);

if (
	! ssn_require_once_if_exists( $soter_autoload ) &&
	! ssn_require_once_if_exists( $project_autoload )
) {
	die( 'Unable to find the Composer autoloader.' );
}

$app = new Application( 'Soter Security Checker', '0.1.0' );

$app->add( new CheckProjectCommand );
$app->add( new CheckPluginCommand );
$app->add( new CheckThemeCommand );
$app->add( new CheckWordPressCommand );
$app->add( new CacheClearCommand );

$app->run();
