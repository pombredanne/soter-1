<?php
/**
 * Builds and saves the results array.
 *
 * @package soter
 */

namespace Soter\Listeners;

use Soter\Options\Options_Manager;
use Soter_Core\Vulnerability_Interface;

if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**
 * This class logs the IDs of each vulnerability that currently affects a site.
 */
class Log_Vulnerability_Ids {
	protected $options;

	/**
	 * Class constructor.
	 */
	public function __construct( Options_Manager $options ) {
		$this->options = $options;
	}

	/**
	 * Performs the actual logging to the results instance.
	 *
	 * @param Vulnerability_Interface[] $vulnerabilities List of vulnerabilities.
	 */
	public function log_vulnerability_ids( $vulnerabilities ) {
		if ( $vulnerabilities instanceof Vulnerability_Interface ) {
			$vulnerabilities = [ $vulnerabilities ];
		}

		$to_save = [];

		// Reset.
		$this->options->set_vulnerabilities( [] );

		foreach ( $vulnerabilities as $vulnerability ) {
			$to_save[] = absint( $vulnerability->id );
		}

		$this->options->set_vulnerabilities( $to_save );
	}
}
