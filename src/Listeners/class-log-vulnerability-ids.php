<?php

namespace SSNepenthe\Soter\Listeners;

use SSNepenthe\Soter\Options\List_Option;

if ( ! defined( 'ABSPATH' ) ) {
	die;
}

class Log_Vulnerability_Ids {
	protected $results;

	public function __construct( List_Option $results ) {
		$this->results = $results;
	}

	public function init() {
		add_action(
			'soter_check_packages_complete',
			[ $this, 'log_vulnerability_ids' ]
		);
	}

	public function log_vulnerability_ids( array $vulnerabilities ) {
		$this->results->reset();

		foreach ( $vulnerabilities as $vulnerability ) {
			$this->results->add( absint( $vulnerability->id ) );
		}

		$this->results->save();
	}
}
